import{r as v,a as R,j as T,b as f,F as O}from"./vendor-60533d1b.chunk.js";import{s as G,g as j,D as V}from"./muiDataGrid-9372440d.chunk.js";import{g as L,a as F,S as H,u as C,L as X,E as Y,c as W,f as B,i as K}from"./404-b20da86c.js";import{h as E}from"./moment-57df9225.chunk.js";let b=new Map;const h=[{market:"tw",stock_ids:["TAIEX"]},{market:"us",stock_ids:["^DJI","^GSPC","^IXIC","^SOX"]}],M=h.reduce((s,a)=>{const{market:e}=a;return{...s,[e]:L(e)}},{}),$=h.reduce((s,a)=>{const{market:e}=a;return{...s,[e]:F(e)}},{});function Q(){const[s,a]=v.useState(null),{token:e}=v.useContext(H),w=R(),o=C(M.tw,e,"stocks_info_tw"),r=C(M.us,e,"stocks_info_us");let y=[],t=null,p="idle",I=s!==null?s.length:0;function A(d){w(`/stock_market/${d.row.market}/${d.id}`)}return(o.error||r.error)&&(t=o.error||r.error),!t&&(o.stage==="fetching"||r.stage==="fetching")&&(p="fetching"),o.stage==="fetched"&&r.stage==="fetched"&&(t=null,p="fetched"),v.useEffect(()=>{function d(n,_){const c=`stock_price_${n}_${_}`;if(b.has(c))return b.get(c);const D={dataset:$[n],data_id:_,start_date:E().subtract(7,"days").format("YYYY-MM-DD"),end_date:E().format("YYYY-MM-DD")},S=W(e?{...D,token:e}:D);return B({url:{NVM_INC:"/Users/yisen/.nvm/versions/node/v22.18.0/include/node",npm_package_devDependencies__tailwindcss_typography:"^0.5.9",npm_package_devDependencies_prettier:"^2.8.7",npm_package_devDependencies_postcss_import:"^15.1.0",TERM_PROGRAM:"vscode",NODE:"/Users/yisen/.nvm/versions/node/v22.18.0/bin/node",INIT_CWD:"/Users/yisen/Documents/Web Design/stocks-watch-list",NVM_CD_FLAGS:"-q",npm_package_devDependencies_vite_imagetools:"^4.0.18",npm_package_dependencies_moment:"^2.29.4",npm_package_dependencies_axios:"^1.3.5",npm_package_homepage:"https://yisenliu.github.io/stocks-watch-list",npm_config_version_git_tag:"true",SHELL:"/bin/zsh",TERM:"xterm-256color",npm_package_devDependencies_vite:"^4.2.0",npm_package_dependencies_pace_js:"^1.2.4",npm_package_dependencies__emotion_styled:"^11.10.8",TMPDIR:"/var/folders/n7/7qh333xj6kg5jm92j4mvf0600000gn/T/",npm_package_dependencies__mui_icons_material:"^5.11.16",npm_package_scripts_lint:"eslint . --ext .js,.jsx",npm_config_init_license:"MIT",TERM_PROGRAM_VERSION:"1.103.2",npm_package_scripts_dev:"vite",MallocNanoZone:"0",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",npm_package_dependencies_flexsearch:"^0.7.31",npm_package_dependencies_twin_macro:"^3.3.1",npm_package_dependencies_moment_business:"^3.0.1",npm_package_private:"true",npm_config_registry:"https://registry.yarnpkg.com",npm_package_scripts_server:"node server.cjs",npm_package_dependencies_react_dom:"^18.2.0",npm_package_dependencies__vercel_speed_insights:"^1.2.0",npm_package_readmeFilename:"README.md",npm_package_dependencies_idb:"^7.1.1",USER:"yisen",NVM_DIR:"/Users/yisen/.nvm",npm_package_description:"自訂台股與美股上市公司股票與 ETF 觀察名單。",npm_package_devDependencies__types_react:"^18.0.28",COMMAND_MODE:"unix2003",npm_package_scripts_deploy:"gh-pages -d dist",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.B2zOm12515/Listeners",npm_package_dependencies_lodash:"^4.17.21",__CF_USER_TEXT_ENCODING:"0x1F5:0x2:0x35",npm_package_devDependencies_postcss:"^8.4.21",npm_package_devDependencies_eslint:"^8.38.0",npm_execpath:"/usr/local/lib/node_modules/yarn/bin/yarn.js",npm_package_devDependencies_vite_plugin_markdown:"^2.1.0",npm_package_dependencies__mui_material:"^5.12.2",npm_package_devDependencies_eslint_plugin_prettier:"^4.2.1",npm_package_devDependencies__types_react_dom:"^18.0.11",PATH:"/var/folders/n7/7qh333xj6kg5jm92j4mvf0600000gn/T/yarn--1756261260942-0.3255565421028481:/Users/yisen/Documents/Web Design/stocks-watch-list/node_modules/.bin:/Users/yisen/.config/yarn/link/node_modules/.bin:/Users/yisen/.nvm/versions/node/v22.18.0/libexec/lib/node_modules/npm/bin/node-gyp-bin:/Users/yisen/.nvm/versions/node/v22.18.0/lib/node_modules/npm/bin/node-gyp-bin:/Users/yisen/.nvm/versions/node/v22.18.0/bin/node_modules/npm/bin/node-gyp-bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/opt/X11/bin:/Users/yisen/.yarn/bin:/Users/yisen/.config/yarn/global/node_modules/.bin:/Users/yisen/.nvm/versions/node/v22.18.0/bin:/Users/yisen/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand",npm_config_argv:'{"remain":[],"cooked":["run","build"],"original":["run","build"]}',_:"/Users/yisen/Documents/Web Design/stocks-watch-list/node_modules/.bin/vite",npm_package_devDependencies__tailwindcss_aspect_ratio:"^0.4.2",__CFBundleIdentifier:"com.microsoft.VSCode",PWD:"/Users/yisen/Documents/Web Design/stocks-watch-list",npm_package_devDependencies_tailwindcss:"^3.3.2",npm_package_dependencies_highlight_words:"^1.2.2",npm_package_scripts_preview:"vite preview",npm_package_devDependencies_eslint_plugin_react_hooks:"^4.6.0",npm_lifecycle_event:"build",LANG:"en_US.UTF-8",npm_package_name:"stocks-watch-list",npm_package_devDependencies__babel_preset_react:"^7.22.5",npm_package_scripts_build:"vite build",npm_package_scripts_start:"nvm use 22.18.0",npm_package_devDependencies_sass:"^1.61.0",npm_config_version_commit_hooks:"true",XPC_FLAGS:"0x0",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",npm_package_devDependencies_vite_plugin_babel_macros:"^1.0.6",npm_package_dependencies_react_router_dom:"^6.11.1",npm_package_devDependencies__tailwindcss_forms:"^0.5.3",npm_config_bin_links:"true",npm_package_dependencies_react_beautiful_dnd:"^13.1.1",npm_package_engines_node:"^22.18.0",npm_package_devDependencies_eslint_config_prettier:"^8.8.0",XPC_SERVICE_NAME:"application.com.microsoft.VSCode.110862266.110862272",npm_package_dependencies__emotion_react:"^11.10.8",npm_package_version:"1.0.0",npm_package_devDependencies_autoprefixer:"^10.4.14",HOME:"/Users/yisen",SHLVL:"1",npm_package_type:"module",VSCODE_GIT_ASKPASS_MAIN:"/Applications/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",npm_config_save_prefix:"^",npm_config_strict_ssl:"true",npm_package_devDependencies_cross_env:"^7.0.3",npm_config_version_git_message:"v%s",npm_package_scripts_buildForGithub:"cross-env GithubPages=true yarn run build",npm_package_config_breakpoints_1:"1024",LOGNAME:"yisen",YARN_WRAP_OUTPUT:"false",npm_package_config_breakpoints_0:"768",npm_lifecycle_script:"vite build",npm_package_devDependencies_gh_pages:"^5.0.0",VSCODE_GIT_IPC_HANDLE:"/var/folders/n7/7qh333xj6kg5jm92j4mvf0600000gn/T/vscode-git-037e65386d.sock",npm_package_scripts_clean_cache:"yarn cache clean",npm_package_devDependencies__vitejs_plugin_react_swc:"^3.3.2",npm_package_dependencies_react:"^18.2.0",NVM_BIN:"/Users/yisen/.nvm/versions/node/v22.18.0/bin",npm_package_dependencies__mui_x_data_grid_pro:"^6.9.0",npm_config_version_git_sign:"",npm_config_ignore_scripts:"",npm_config_user_agent:"yarn/1.22.22 npm/? node/v22.18.0 darwin x64",GIT_ASKPASS:"/Applications/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",VSCODE_GIT_ASKPASS_NODE:"/Applications/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",npm_package_dependencies_recharts:"^2.5.0",npm_package_dependencies_express:"^4.18.2",npm_config_init_version:"1.0.0",npm_config_ignore_optional:"",COLORTERM:"truecolor",npm_node_execpath:"/Users/yisen/.nvm/versions/node/v22.18.0/bin/node",npm_package_devDependencies_eslint_plugin_react:"^7.32.2",npm_package_dependencies_http_proxy_middleware:"^2.0.6",npm_config_version_tag_prefix:"v",NODE_ENV:"production",VIPSHOME:"/Users/runner/work/sharp-libvips/sharp-libvips/target"}.GithubPages?"https://corsproxy.io/?"+encodeURIComponent("https://api.finmindtrade.com/api/v4/data"+S):"/api/stock"+S,headers:{"content-type":"application/x-www-form-urlencoded"}}).then(m=>m.data.data).then(async m=>{const x=`stocks_info_${n}`,{db:U}=await K(x),u=await U.getFromIndex(x,"stock_id",_),P=(u==null?void 0:u.stock_name)||"-",k=m[m.length-1];let i={market:n,id:_,spread:"-",close:"-",open:"-",name:P};if(k){if(n==="tw"){const{spread:g,close:l,open:N}=k;i={...i,spread:g,close:l,open:N}}if(n==="us"){const{Close:g,Open:l}=k;i={...i,spread:g-l,close:g,open:l}}}return b.set(c,i),i})}p==="fetched"&&(h.forEach(({market:n,stock_ids:_})=>{_.forEach(c=>y.push(d(n,c)))}),Promise.all(y).then(n=>{a(n)}))},[p]),T(O,{children:[p==="fetching"&&f(X,{}),t&&f(Y,{children:t.message}),I>0&&f(V,{className:"-m-4",columns:G,disableColumnMenu:!0,disableColumnResize:!0,hideFooter:!0,onRowClick:A,rows:s,sx:j})]})}export{Q as MarketIndex};
