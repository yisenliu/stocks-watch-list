import{aE as K,b as t,j as h,aF as W,r as u,ar as C,aG as Y,F as L,f as j,a as J,aw as M,I,ax as H,aH as Q,aI as Z,aJ as F,aK as ee,aL as te,aM as re,p as A,S as R,aN as ne,aO as ae,aP as oe,O as se,N as ie,V as D,ap as P,aQ as ce,aR as le,aS as ue,at as de,u as fe,aT as me,aU as he,aV as pe,aW as we,aX as ge,aY as ye}from"./vendor-262f8ba3.chunk.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const ke="modulepreload",xe=function(e){return"/stocks-watch-list/"+e},O={},v=function(r,n,s){if(!n||n.length===0)return r();const o=document.getElementsByTagName("link");return Promise.all(n.map(a=>{if(a=xe(a),a in O)return;O[a]=!0;const i=a.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(!!s)for(let f=o.length-1;f>=0;f--){const w=o[f];if(w.href===a&&(!i||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${c}`))return;const l=document.createElement("link");if(l.rel=i?"stylesheet":ke,i||(l.as="script",l.crossOrigin=""),l.href=a,document.head.appendChild(l),i)return new Promise((f,w)=>{l.addEventListener("load",f),l.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>r())};K.options={ajax:!1};K.start();function ve({children:e}){return t("div",{"data-name":"page",className:"flex flex-col w-full h-screen overflow-x-hidden overflow-y-auto",children:e})}function T({name:e,children:r}){return h("div",{"data-name":"nav-group",className:"flex flex-col py-2 space-y-2",children:[e&&t("h3",{className:"text-sm text-gray-600",children:e}),r]})}function _({noEffect:e,to:r,text:n,onClick:s,count:o=0}){return h(W,{to:r,onClick:s,className:({isActive:a,isPending:i})=>{let c="";return i?c+="pending":c+=a?e?"font-bold":"bg-primary/80 text-amber-500 font-bold px-4 -mx-4":"",c+" py-2"},children:[n,o>0&&t("span",{className:"float-right",children:o})]})}const b=u.createContext();b.displayName="StockContext";const _e="z-2 top-0 fixed bg-black/75 ",$={open:"translate-x-0",close:"-translate-x-full"};function Se({isOpen:e,closeMenu:r}){const{logout:n,userId:s,watchList:o}=u.useContext(b),a=u.useRef(),i=e?$.open:$.close,[c,d]=u.useState(!1);return u.useEffect(()=>{const l=a.current;function f(){d(!0)}return c&&l.addEventListener("transitionend",f),()=>l.removeEventListener("transitionend",f)},[c]),t(L,{children:!c&&t("div",{"data-name":"navigation",className:_e+(e?"w-full":"w-0"),onClick:r,children:h("div",{ref:a,className:"flex flex-col transition-transform w-64 h-screen p-4  text-white bg-gray-900 divide-y divide-gray-800 "+i,children:[t(_,{to:"/",text:"Home",noEffect:!0,onClick:r}),t(T,{children:t(_,{to:"market_index",text:"大盤指數",onClick:r})}),h(T,{name:"股票觀察表",children:[t(_,{to:"stock_market/tw",text:"台股",count:o.tw.length,onClick:r}),t(_,{to:"stock_market/us",text:"美股",count:o.us.length,onClick:r})]}),h(T,{name:"其他資料集",children:[t(_,{to:"us_treasury_bound",text:"美國政府公債殖利率",onClick:r}),t(_,{to:"gold_price",noEffect:!0,text:"黃金現貨價格",onClick:r}),t(_,{to:"crude_oil_prices",noEffect:!0,text:"原油價格",onClick:r})]}),sessionStorage.getItem("user_id")&&t(C,{variant:"contained",endIcon:t(Y,{}),sx:{textTransform:"none"},onClick:l=>{n(),r(l)},children:`登出 ${s}`})]})})})}function be(e){let r,n={tw(){return"TaiwanStockInfo"},us(){return"USStockInfo"},default(){throw new Error(`Unavailable service in ${e.toUpperCase()} market.`)}};return r=n[e]?n[e]:n.default,r()}function Me(e){let r,n={tw(){return"TaiwanStockPrice"},us(){return"USStockPrice"},default(){throw new Error(`Unavailable service in ${e.toUpperCase()} market.`)}};return r=n[e]?n[e]:n.default,r()}function V({children:e}){return t("p",{className:"mx-4 my-4 text-center text-red-200",children:e})}const Ie=j`
  ${{margin:"1rem",display:"flex",alignItems:"center",justifyContent:"center","--tw-text-opacity":"1",color:"rgb(255 255 255 / var(--tw-text-opacity))"}}
  &::before {
    content: '';
    ${{marginRight:"0.25rem",height:"1rem",width:"1rem","@keyframes spin":{to:{transform:"rotate(360deg)"}},animation:"spin 1s linear infinite",borderRadius:"9999px",borderWidth:"3px",borderColor:"rgb(0 172 193 / 0.4)","--tw-border-opacity":"1",borderTopColor:"rgb(0 172 193 / var(--tw-border-opacity))"}}
  }
`;function Ce(){return t("p",{css:Ie,children:"Loading..."})}function z({text:e,query:r}){const n=r.trim().replace(/\s+/g," ").split(" ").join("|"),s=new RegExp(`(${n})`,"i");return Q({text:e,query:s}).map(({text:a,match:i,key:c})=>i?t("span",{className:"text-amber-500",children:a},c):t("span",{children:a},c))}function Ee({keyword:e,stock:r}){const{dispatch:n,watchList:s,market:o}=u.useContext(b),a=s[o],{stock_id:i,stock_name:c,industry_category:d,type:l}=r,f=a.some(m=>m.id===i),w=J();function y(m){m.stopPropagation(),n({type:"add_stocks",market:o,stocks:[{id:i}]})}function k(m){m.stopPropagation(),n({type:"remove_stocks",market:o,stocks:[{id:i}]})}return h("div",{className:"flex items-center justify-between p-2 space-x-4 cursor-pointer",onClick:()=>w(`/stock_market/${o}/${i}`),children:[t("p",{className:"w-16 text-lg",children:t(z,{text:i,query:e})}),h("p",{className:"flex-1",children:[t(z,{text:c,query:e}),o==="tw"&&h("span",{className:"block text-sm text-gray-500",children:[d,"-",l.toUpperCase()]})]}),f&&t(I,{onClick:k,"aria-label":"remove from watch list",sx:{color:"white"},children:t(M,{fontSize:"small"})}),!f&&t(I,{onClick:y,"aria-label":"add to watch list",sx:{color:"white"},children:t(H,{fontSize:"small"})})]})}function Te({keyword:e,stocks:r}){return t("div",{className:"z-1 top-12 absolute left-0 w-full shadow-md",children:t("div",{className:"max-h-64 overflow-x-hidden overflow-y-auto text-white bg-gray-900",children:r.map((n,s)=>t(Ee,{keyword:e,stock:n},n.stock_id+s))})})}function B(e,r,n){e.createObjectStore(r,{keyPath:"id",autoIncrement:!0}).createIndex(n,n)}async function Re(e){console.log({storeName:e});const r=await Z("my_database",1,{upgrade(s,o,a,i){console.log({oldVersion:o,newVersion:a}),o<1?(B(s,"stocks_info_tw","stock_id"),B(s,"stocks_info_us","stock_id")):i(e).objectStore(e)}});async function n(s,o,a){const i=s.transaction(a,"readwrite"),c=d=>d.map(l=>i.store.add(l));await Promise.all([...c(o),i.done])}return{db:r,storeData:n}}function X(e){return F(e)}F.create;function Le(e){let r="?";for(const[n,s]of Object.entries(e))r+=`${n}=${s}&`;return r.slice(0,-1)}function Ne(e,r=null,n){const s=Le(r?{dataset:e,token:r}:{dataset:e}),[o,a]=u.useState(null),[i,c]=u.useState(null),[d,l]=u.useState("idle"),f={url:"https://corsproxy.io/?"+encodeURIComponent("https://api.finmindtrade.com/api/v4/data"+s),timeout:8e3,headers:{"content-type":"application/x-www-form-urlencoded"}};return u.useEffect(()=>{let w,y=!1,k=0;async function m(){const{db:x,storeData:p}=await Re(n),S=await x.getAll(n);S.length?(a(S),l("fetched")):(l("fetching"),c(null),X(f).then(g=>g.data.data).then(async g=>{y||(await p(x,g,n),a(g),l("fetched"),c(null),k=0)}).catch(g=>{k++,k<=2?(w=setTimeout(m,1e3),g.message.includes("timeout")?g={...g,message:"請求逾時 (Retry...)"}:g={...g,message:g.message+" (Restarting...)"}):g={...g,message:"重試次數已達上限，請稍候再試。"},c(g),l("idle")}))}return m(),()=>{y=!0,a(null),c(null),l("idle"),clearTimeout(w)}},[e]),{data:o,error:i,stage:d}}const De=ee.input({marginRight:"0.5rem",width:"100%",borderStyle:"none",backgroundColor:"transparent",":focus":{"--tw-ring-offset-shadow":"var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color)","--tw-ring-shadow":"var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color)",boxShadow:"var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)"}});function Pe(e,r){let n=null;return function(...s){let o=this;clearTimeout(n),n=setTimeout(()=>{e.apply(o,s)},r)}}function Oe(){const{keyword:e,market:r,setKeyword:n,token:s}=u.useContext(b),o=be(r),{data:a,error:i,stage:c}=Ne(o,s,`stocks_info_${r}`),d=u.useRef(),l=Pe(m=>n(m.target.value.toUpperCase()),300),f=new te({tokenize:"full"});a==null||a.forEach(({stock_id:m,stock_name:x},p)=>f.add(p,m+","+x));const y=f.search(e).map(m=>a[m]);function k(){d.current.value="",d.current.focus(),n("")}return h(L,{children:[c==="fetching"&&t(Ce,{}),i&&t(V,{children:i.message}),c==="fetched"&&h("div",{"data-name":"keyword_search",className:"flex items-center flex-1",children:[t(De,{type:"text",autoFocus:!0,placeholder:"輸入代碼或關鍵字",onChange:l,ref:d}),e!==""&&t(I,{onClick:k,"aria-label":"clear input",size:"large",sx:{color:"white"},children:t(re,{fontSize:"inherit"})}),y!==null&&t(Te,{stocks:y,keyword:e})]})]})}const $e=j`
  ${{display:"flex",height:"3rem",cursor:"pointer",flexDirection:"column",alignItems:"center",justifyContent:"center","::before":{content:"var(--tw-content)",transformOrigin:"bottom left"},"::after":{content:"var(--tw-content)",transformOrigin:"top left"}}}
  &::before,
  &::after {
    content: '';
    ${{display:"block",height:"2px",width:"1.5rem","--tw-bg-opacity":"1",backgroundColor:"rgb(255 255 255 / var(--tw-bg-opacity))",transitionProperty:"all",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:"300ms"}}
  }
  span {
    ${{marginTop:"0.25rem",marginBottom:"0.25rem",display:"block",height:"2px",width:"1.5rem",transformOrigin:"left","--tw-bg-opacity":"1",backgroundColor:"rgb(255 255 255 / var(--tw-bg-opacity))",fontSize:"0",lineHeight:"0",transitionProperty:"all",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:"300ms"}}
  }
  &.active {
    &::before {
      ${{"--tw-translate-y":"6px",transform:"translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))","--tw-rotate":"-45deg","--tw-scale-x":".5"}}
    }
    &::after {
      ${{"--tw-translate-y":"-6px",transform:"translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))","--tw-rotate":"45deg","--tw-scale-x":".5"}}
    }
    span {
      ${{"--tw-scale-x":".75",transform:"translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))"}}
    }
  }
`;function ze(e){let r;const n={"/market_index":()=>"大盤指數","/stock_market/tw":()=>"台股","/stock_market/us":()=>"美股","/us_treasury_bound":()=>"美國政府公債殖利率",default:()=>""};return r=n[e]?n[e]:n.default,r()}function U({showDetailedRow:e,onClick:r}){return h(I,{onClick:r,"aria-label":"show/hide stock name",size:"large",sx:{color:"white"},children:[e&&t(ae,{fontSize:"medium"}),!e&&t(oe,{fontSize:"medium"})]})}function Be(){const{isShowKeywordSearch:e,setKeyword:r,setIsShowKeywordSearch:n,showDetailedRow:s,setShowDetailedRow:o}=u.useContext(b),{pathname:a}=A(),i=ze(a),c=a.includes("stock_market"),d=a.includes("market_index"),[l,f]=u.useState(!1);function w(x){x.target===x.currentTarget&&f(!1)}function y(){n(!0)}function k(){e?(n(!1),r("")):f(!0)}function m(){localStorage.setItem("show_detailed_row",!s),o(!s)}return h("header",{"data-name":"header",className:"z-1 sticky top-0 w-full text-white bg-gray-900",children:[h(R,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{height:48},children:[t(C,{css:$e,className:e?"active":"",onClick:k,disableRipple:!0,children:t("span",{children:"Open Navigation"})}),i&&!e&&t("h3",{className:"flex-1 text-left",children:i}),c&&!e&&h(L,{children:[t(I,{onClick:y,"aria-label":"show input",size:"large",sx:{color:"white"},children:t(ne,{fontSize:"medium"})}),t(U,{showDetailedRow:s,onClick:m})]}),c&&e&&t(Oe,{}),d&&t(U,{showDetailedRow:s,onClick:m})]}),t(Se,{isOpen:l,closeMenu:w})]})}function Ue({children:e}){return t("main",{"data-name":"content",className:"flex-grow p-4 bg-gray-800",children:e})}function Ke(){return h(ve,{children:[t(Be,{}),t(Ue,{children:t(se,{})})]})}function je(e,r){return X({method:"post",url:"https://corsproxy.io/?"+encodeURIComponent("https://api.finmindtrade.com/api/v4/login"),headers:{"content-type":"application/x-www-form-urlencoded"},data:{user_id:e,password:r}}).then(n=>n.data).catch(n=>n.response.data)}const Fe={margin:"4rem auto",width:"min(90vw,320px)",bgcolor:"#fff",borderRadius:1,p:4};function Ae({onSuccess:e}){const r=ie(),[n,s]=u.useState(!1),[o,a]=u.useState(""),[i,c]=u.useState(""),[d,l]=u.useState({userId:null,password:null,feedback:null}),[f,w]=u.useState(null);function y(){l({userId:null,password:null,feedback:null})}function k(p){p.key==="Enter"&&(p.preventDefault(),m())}async function m(){if(y(),o.length>0&&i.length>0){const p=await je(o,i);p.status===200?(w(p.token),s(!0)):l(S=>({...S,feedback:p.msg}))}else o.length===0&&l(p=>({...p,userId:"請輸入帳號"})),i.length===0&&l(p=>({...p,password:"請輸入密碼"}))}function x(){a("guest"),s(!0)}return u.useEffect(()=>{n&&e(o,f)},[n]),h(de,{component:"form",noValidate:!0,autoComplete:"off",sx:Fe,children:[h(R,{direction:"column",spacing:2,children:[t(D,{component:"h2",align:"center",variant:"h5",children:"FinMind 會員登入"}),d.feedback&&t(D,{component:"p",align:"center",color:r.palette.error.main,children:"登入失敗，請檢查帳號或密碼。"}),t(P,{required:!0,id:"user_id",label:"帳號",value:o,error:d.userId!==null,helperText:d.userId,onChange:p=>a(p.target.value),onKeyDown:k}),t(P,{autoComplete:"true",required:!0,id:"password",label:"密碼",type:"password",value:i,error:d.password!==null,helperText:d.password,onChange:p=>c(p.target.value),onKeyDown:k}),t(C,{variant:"contained",size:"large",sx:{textTransform:"none"},onClick:m,children:"登入"}),t(C,{size:"large",sx:{textTransform:"none",textDecoration:"underline"},onClick:x,children:"以訪客身份登入"})]}),h(R,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,sx:{mt:2},children:[h(ce,{to:"/",className:"text-blueGray-500 py-3 text-sm",children:[t(le,{sx:{mr:1}}),"首頁"]}),h("a",{href:"https://finmindtrade.com/analysis/#/account/register",target:"_blank",className:"text-blueGray-500 py-3 text-sm",rel:"noreferrer",children:[t(ue,{sx:{mr:1}}),"註冊"]})]})]})}function Ve(e,r){const{market:n,stocks:s,type:o}=r;let a=null;switch(o){case"add_stocks":a=[...e[n],...s];break;case"remove_stocks":a=e[n].filter(i=>s.every(c=>c.id!==i.id));break;case"update_stocks":a=s;break}return localStorage.setItem(`stocks_${n}`,JSON.stringify(a)),{...e,[n]:a}}function Xe(){const e={tw:JSON.parse(localStorage.getItem("stocks_tw"))||[{id:"TAIEX"}],us:JSON.parse(localStorage.getItem("stocks_us"))||[{id:"^DJI"},{id:"^GSPC"},{id:"^IXIC"},{id:"^SOX"}]};for(const[r,n]of Object.entries(e))localStorage.getItem(`stocks_${r}`)||localStorage.setItem(`stocks_${r}`,JSON.stringify(n));return e}function qe(){const[e,r]=u.useState(""),[n,s]=u.useState(!1),[o,a]=u.useState(localStorage.getItem("show_detailed_row")==="true"),[i,c]=u.useState(sessionStorage.getItem("token")||null),[d,l]=u.useState(sessionStorage.getItem("user_id")||null),[f,w]=u.useReducer(Ve,null,Xe),y=A(),k=y.pathname,{market:m}=fe(),p=me([{path:"stock_market/:market"},{path:"stock_market/:market/:stock_id"}],y),S={dispatch:w,isShowKeywordSearch:n,setIsShowKeywordSearch:s,keyword:e,setKeyword:r,logout:g,market:m,showDetailedRow:o,setShowDetailedRow:a,token:i,userId:d,watchList:f};function g(){l(null),c(null),sessionStorage.removeItem("user_id"),sessionStorage.removeItem("token")}function q(N,E){l(N),sessionStorage.setItem("user_id",N),E&&(c(E),sessionStorage.setItem("token",E))}function G(){r(""),s(!1)}return u.useEffect(()=>{G()},[k]),h(b.Provider,{value:S,children:[p&&!d&&t(Ae,{onSuccess:q}),(!p||d)&&t(Ke,{})]})}function Ge(){const e=he();return console.error(e),h("div",{id:"error-page",className:"mt-24 space-y-8 text-center text-white",children:[t("h1",{className:"text-5xl font-bold",children:t(pe,{fontSize:"inherit",color:"inherit"})}),t("p",{children:"Sorry, an unexpected error has occurred."}),t(V,{children:e.statusText||e.message})]})}const We=we([{path:"/",element:t(qe,{}),errorElement:t(Ge,{}),children:[{async lazy(){let{Index:e}=await v(()=>import("./Index-a10fa6d5.chunk.js"),["assets/Index-a10fa6d5.chunk.js","assets/vendor-262f8ba3.chunk.js"]);return{Component:e}},index:!0},{path:"stock_market/:market",async lazy(){let{StockList:e}=await v(()=>import("./StockList-16c0e113.chunk.js"),["assets/StockList-16c0e113.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/muiDataGrid-b223cdf5.chunk.js","assets/moment-e953ecbf.chunk.js"]);return{Component:e}},children:[{path:":stock_id",async lazy(){let{StockDetails:e}=await v(()=>import("./StockDetails-1a10221c.chunk.js"),["assets/StockDetails-1a10221c.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/Tab-5c183902.chunk.js","assets/moment-e953ecbf.chunk.js","assets/index-658e0e07.chunk.js"]);return{Component:e}},loader:({params:e})=>e.stock_id.toUpperCase()}]},{path:"us_treasury_bound",async lazy(){let{TreasuryBoundList:e}=await v(()=>import("./TreasuryBoundList-482c5eb9.chunk.js"),["assets/TreasuryBoundList-482c5eb9.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/muiDataGrid-b223cdf5.chunk.js","assets/moment-e953ecbf.chunk.js"]);return{Component:e}},children:[{path:":bound_data_id",async lazy(){let{TreasuryBound:e}=await v(()=>import("./TreasuryBound-91bdbd1b.chunk.js"),["assets/TreasuryBound-91bdbd1b.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/Tab-5c183902.chunk.js","assets/moment-e953ecbf.chunk.js","assets/index-658e0e07.chunk.js"]);return{Component:e}}}]},{path:"gold_price",async lazy(){let{GoldPrice:e}=await v(()=>import("./GoldPrice-aeec3e86.chunk.js"),["assets/GoldPrice-aeec3e86.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/Tab-5c183902.chunk.js","assets/moment-e953ecbf.chunk.js"]);return{Component:e}}},{path:"crude_oil_prices",async lazy(){let{CrudeOilPrices:e}=await v(()=>import("./CrudeOilPrices-97c69ce0.chunk.js"),["assets/CrudeOilPrices-97c69ce0.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/Tab-5c183902.chunk.js","assets/moment-e953ecbf.chunk.js","assets/index-658e0e07.chunk.js"]);return{Component:e}}},{path:"market_index",async lazy(){let{MarketIndex:e}=await v(()=>import("./MarketIndex-58ac559c.chunk.js"),["assets/MarketIndex-58ac559c.chunk.js","assets/vendor-262f8ba3.chunk.js","assets/muiDataGrid-b223cdf5.chunk.js","assets/moment-e953ecbf.chunk.js"]);return{Component:e}}}]}],{basename:"/stocks-watch-list/"}),Ye=ge(document.getElementById("root"));Ye.render(t(ye,{router:We}));export{V as E,Ce as L,b as S,Me as a,Le as c,X as f,be as g,Re as i,Ne as u};
