import{e as _,g as M,b as h,j as C,r as g,F as R}from"./vendor-262f8ba3.chunk.js";import{u as B,S as L,H as O,b as T,C as z}from"./Tab-5c183902.chunk.js";import{c as A,L as G,E as U}from"./404-a52e1c64.js";import{h as l}from"./moment-e953ecbf.chunk.js";var N={exports:{}},w={exports:{}},I={exports:{}},V;function J(){return V||(V=1,function(u,m){(function(i,s){u.exports=s()})(_,function(){function i(o,t,e){var r=(t-o)/e,n=!(r%.5)&&r%1,a=n?e:0;return a+(t-e*Math.round(r))}var s=i;return s})}(I)),I.exports}var E;function Q(){return E||(E=1,function(u,m){(function(i,s){u.exports=s(J())})(_,function(i){function s(t,e,r,n){if(t===e)return 0;if(t>e){var a=t;t=e,e=a}e--;var c=i(t,r,n);return c-t<0&&(c+=n),c-t>e-t?0:1+parseInt((e-c)/n)}var o=s;return o})}(w)),w.exports}(function(u,m){(function(i,s){u.exports=s(Q())})(_,function(i){function s(t){return t=+t,t>0?1:-1}var o={weekDays:function(e,r){var n=void 0,a=void 0,c=r.isBefore(e);c?(n=r,a=e):(n=e,a=r);var f=n.day(),d=Math.abs(a.diff(n,"days")),b=i(f,d+f,0,7),D=i(f,d+f,6,7),v=c?-1:1;return v*(d-(D+b))},weekendDays:function(e,r){var n=r.diff(e,"days"),a=this.weekDays(e,r);return n-a},addWeekDays:function(e,r){if(r===0||isNaN(r))return e;var n=s(r),a=e.day(),c=Math.abs(r),f=0;(a===0&&n===-1||a===6&&n===1)&&(f=1);var d=c;a!==0&&a!==6&&n>0?d+=a:a!==0&&a!==6&&n<0&&(d+=6-a);var b=Math.max(Math.floor(d/5)-1,0)+(d>5&&d%5>0?1:0);return f+=c+b*2,e.add(n*f,"days"),e},subtractWeekDays:function(e,r){return this.addWeekDays(e,-r)},isWeekDay:function(e){return e.isoWeekday()<6},isWeekendDay:function(e){return e.isoWeekday()>5}};return o})})(N);var X=N.exports;const Z=M(X);function $({options:u,currentIdx:m,onChange:i}){return h("div",{"data-name":"duration_picker",className:"flex -mx-4 -mb-4",children:u.map(({text:s},o)=>C("label",{className:"flex-1 py-2 text-center cursor-pointer border-b-3 "+(o===m?"border-white text-white":"border-transparent text-primary"),children:[h("input",{type:"radio",name:"duration",id:"",value:o,onChange:i,defaultChecked:o===m,className:"!hidden"}),s]},s))})}function K({dataset:u,data_id:m=null,token:i=null,start_date:s=l().subtract(5,"year").format("YYYY-MM-DD"),end_date:o=l().format("YYYY-MM-DD")}){const t={dataset:u,data_id:m,token:i,start_date:s,end_date:o};for(const[n,a]of Object.entries(t))a||delete t[n];const e=A(t);return B({url:"https://corsproxy.io/?"+encodeURIComponent("https://api.finmindtrade.com/api/v4/data"+e),timeout:8e3,headers:{"content-type":"application/x-www-form-urlencoded"}},[m,u])}const k=[{startDate:l().subtract(l().dayOfYear()-1,"days"),text:"YTD"},{startDate:l().subtract(1,"months"),text:"1月"},{startDate:l().subtract(2,"months"),text:"3月"},{startDate:l().subtract(6,"months"),text:"6月"},{startDate:l().subtract(1,"years"),text:"1年"},{startDate:l().subtract(3,"years"),text:"3年"},{startDate:l().subtract(5,"years"),text:"5年"}];function ne({dataset:u,data_id:m,closeKey:i,minKey:s,maxKey:o,token:t,tooltipValueLabel:e}){const[r,n]=g.useState(parseInt(localStorage.getItem("current_duration_idx"))||0),[a,c]=g.useState({min:null,max:null}),{data:f,error:d,stage:b}=K({dataset:u,data_id:m,token:t}),D=f||[],v=D.length,j=Z.weekDays(k[r].startDate,l()),H=k[r].text,S=v-j,y=g.useMemo(()=>{if(k[r].text==="YTD"){const x=D.findIndex(p=>p.date.includes(l().year()));return D.slice(x,v)}return D.slice(S>0?S:0,v)},[S]),q=v>0;function F(x){const p=parseInt(x.target.value);n(p),localStorage.setItem("current_duration_idx",p)}return g.useEffect(()=>{let x=null,p=null;y.forEach(W=>{const Y=W[o],P=W[s];(!p||Y>p)&&(p=Y),(!x||P<x)&&(x=P)}),c({min:x,max:p})},[q,r]),h(z,{in:y.length>0,collapsedSize:90,children:C(T,{"data-name":"price_history",className:"text-center",children:[b==="fetching"&&h(G,{}),d&&h(U,{children:d.message}),y.length>0&&C(R,{children:[h(L,{currentDurationLabel:H,currentValue:y[y.length-1][i],startValue:y[0][i],endDate:y[y.length-1].date,min:a.min,max:a.max}),h(O,{history:y,closeKey:i,tooltipValueLabel:e}),h($,{options:k,currentIdx:r,onChange:F})]})]})})}export{ne as H};
